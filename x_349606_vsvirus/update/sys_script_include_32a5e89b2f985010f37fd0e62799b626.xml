<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_349606_vsvirus.TreatmentProtocol</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>TreatmentProtocol</name>
        <script><![CDATA[var TreatmentProtocol = Class.create();

TreatmentProtocol.prototype = {
    initialize: function(treatmentGr) {
        this.treatmentGr = treatmentGr;
    },

    recalculateResult: function() {
        if (!this.treatmentGr)
            return;
		
		var total = this._recordCount(this.treatmentGr);
		var successCount = this._successCount(this.treatmentGr);
		var percentage = (successCount / total) * 100;
		
		this.treatmentGr.setValue('success_rate', percentage);

       
    },
	
	_recordCount: function(treatmentGr) {
		var ga = new GlideAggregate('x_349606_vsvirus_treatment_result');
        ga.addAggregate('COUNT');
        ga.addQuery('treatment_protocol', treatmentGr.getUniqueValue());
		ga.query();
		if (ga.next())
			return ga.getAggregate('COUNT');
		else 
			return false;
	},
	
	_successCount: function(treatmentGr) {
		var ga = new GlideAggregate('x_349606_vsvirus_treatment_result');
        ga.addAggregate('COUNT');
        ga.addQuery('treatment_protocol', treatmentGr.getUniqueValue());
		ga.addQuery('result', 1); // success
		ga.query();
		if (ga.next())
			return ga.getAggregate('COUNT');
		else 
			return false;
	},

    type: 'TreatmentProtocol'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>wrangu.lansford</sys_created_by>
        <sys_created_on>2020-04-25 22:52:37</sys_created_on>
        <sys_id>32a5e89b2f985010f37fd0e62799b626</sys_id>
        <sys_mod_count>4</sys_mod_count>
        <sys_name>TreatmentProtocol</sys_name>
        <sys_package display_value="MediCast" source="x_349606_vsvirus">98e08a3a2f581010f37fd0e62799b6cf</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="MediCast">98e08a3a2f581010f37fd0e62799b6cf</sys_scope>
        <sys_update_name>sys_script_include_32a5e89b2f985010f37fd0e62799b626</sys_update_name>
        <sys_updated_by>wrangu.lansford</sys_updated_by>
        <sys_updated_on>2020-04-26 00:48:00</sys_updated_on>
    </sys_script_include>
</record_update>
